# Moss documents<br>

Để có thể setup được plugin hoàn chỉnh đầu tiên bạn cần viết mapping.json<br>
file mapping hoàn chỉnh có dạng như sau. Cuộn xuống để xem chi tiết từng phần
```json5
{
  "name": "example",
  "description": "This is a example plugins",
  "version": "1.0.0",
  "author": "kenftr",
  "license": "MIT",
  "open_source": true,
  "module": {
    "status": {
      "start": true,
      "stop": true
    },
    "event_file_name": "event.py",
    "start_function": "on_start",
    "stop_function": "on_stop",
    "init_variable": {
      "app": "Moss.app"
    }
  },

  "plugins_setting": {
    "enable": {
      "prefix_command_enable_list": [],
      "slash_command_enable_list": [],
      "command_group_enable_list": [],
      "events_enable_list": []
    }

  },

  "mapping": {
    "format": "Moss-mapping-v2",
    "path": {
      "prefix_command_path": "prefix_command",
      "slash_command_path": "slash_command",
      "command_group_path": "command_group",
      "event_command_path": "event"
    },

    "prefix_command_list": [],
    "slash_command_list": [
      {
        "file_name": "ping_command.py",
        "class": "ping_command",
        "custom_mapping": {
          "enable": true,
          "path": "ping_mapping.json"
        }

      }
    ],
    "command_group_list": [],
    "events_list": []
  },

  "hooks": {
    "on_load": "on_load.py",
    "on_reload": "on_reload.py"
  },

  "require":{
    "python_version": ">=3.8",
    "potato_pc": true,
    "packages": ["discord.py",
                 "colorama"]
  },
  "orther": {
    "loader-mode": "advanced"
  }
}
```

## 🗒️ **Các thông tin cơ bản**
```json5
{
  "name": "",
  "description": "",
  "version": "1.0.0",
  "author": "",
  "license": "MIT",
  "open_source": true,
}
```
**Các key cần biết**
> **name:** Tên plugin, cần trùng với tên folder chứa plugin<br>
> **description:** Mô tả ngắn về plugin <br>
> **version:** Phiên bản plugin<br>
> **author:** Tác giả<br>
> **license:** Giấy phép
> **open_source:** Plugin có open source hay không<br>

## 📦 Module

`Module.status`: Đây là setting chứa các event khi plugin được **load** và **stop**.  
```json
{
  "start": true,
  "stop": true
}
```
**Nếu bạn bật phần này, chúng ta sẽ quan tâm đến các thiết lập bên dưới:**
```json
{
  "event_file_name": "event.py",
  "start_function": "on_start",
  "stop_function": "on_stop",
  "init_variable": {
    "app": "Moss.app"
  }
}
```

### Giải thích

- `event_file_name:` File chứa các event start và stop.  
- `start_function:` Tên hàm sẽ được gọi khi plugin được load.  
- `stop_function:` Tên hàm sẽ được gọi khi plugin được stop.  
- `init_variable:` Các tham số cần thiết cho hàm, Moss sẽ tự động inject khi load.

### **Ví dụ:**
```py
async def on_start(app):
    latency = app.latency() * 1000
    print(latency)
```
> Trong ví dụ trên, hàm `on_start` cần tham số `app`. Vì vậy, ta đưa app vào init_variable kèm với api bạn cần ở đây ta sử dụng `Moss.app`.<br>

`Moss.app` là object commands.Bot của discord.py

##  📦 Plugin Setting
```json
"plugins_setting": {
    "enable": {
      "prefix_command_enable_list": [],
      "slash_command_enable_list": [],
      "command_group_enable_list": [],
      "events_enable_list": []
    }
```
Nếu bạn đưa module vào enable_list thì chỉ có các module đó được load. Nếu không thì sẽ load toàn bộ

##  🗺️ Mapping

```json5
"mapping": {
    "format": "Moss-mapping-v2",
    "path": {
      "prefix_command_path": "prefix_command",
      "slash_command_path": "slash_command",
      "command_group_path": "command_group",
      "event_command_path": "event"
    },

    "prefix_command_list": [],
    "slash_command_list": [
      {
        "file_name": "ping_command.py",
        "class": "ping_command",
        "custom_mapping": {
          "enable": true,
          "path": "ping_mapping.json"
        }

      }
    ],
    "command_group_list": [],
    "events_list": []
  },
```
**Thông tin các key**<br>
`format`: format của mapping. Hiện tại là `Moss-mapping-v2`<br>
`path`: các path của module<br>
**Ví dụ**
```
example/
    ├── slash_command/
    │   └── ping_command.py
    ├── custom_mapping/
    │   └── ping_mapping.json
    └── prefix_command

```
`slash_command_path` = `slash_command` thì Moss sẽ load các **slash command** tại `example/slash_command`

### List

```json5
"prefix_command_list": [
  {
    "file_name": "hello.py",   
    "class": "HelloCommand",   
    "custom_mapping": {        
      "enable": false,
      "path": ""
    }
  },
  {
    "file_name": "kick.py",
    "class": "KickCommand",
    "custom_mapping": {
      "enable": true,
      "path": "kick_mapping.json"
    }
  }
]
```

trong phần này bạn chỉ cần khai báo toàn bộ module trong plugins của bạn<br>
**Các khai báo:**<br>
tùy vào module của bạn event / command / prefix command / command group mà sẽ khai báo ở vị trí khác nhau. ở đây sẽ ví dụ với slash command

Chúng ta sẽ khai báo slash command tại `slash_command_list`

Cấu trúc khai báo như sau:
```json
{
    "file_name": "kick.py",
    "class": "KickCommand",
    "custom_mapping": {
      "enable": false,
      "path": "kick_mapping.json"
    }
  }
```
với file name là file chứa class chính. Còn class là nơi mà Moss sẽ import.
Ở đây chúng ta không cần quan tâm custom_mapping. Vì vậy bạn hãy đặt nó là `false`

**Ví dụ:** Chúng ta khai báo slash_command **ping**

**Structure**
```
example/
    └── slash_command/
        └── ping_command.py <- slash command ở đây

```
cho class `ping_command_class` trong `ping_command.py` là nơi chứa object command thì khai báo như sau
```json
{
    "file_name": "ping_command.py",
    "class": "ping_command_class",
    "custom_mapping": {
      "enable": false
    }
}
```
Nội dung trong ping_command nếu bạn cần.
```py
from discord import app_commands,Interaction
from discord.ext import commands

from typing import Optional
class ping_command_class(commands.Cog):
    def __init__(self,bot):
        self.app: Optional[commands.Bot]=bot

    @app_commands.command(name='ping',description='check bot latency')
    async def ping(self,interaction:Interaction) -> None:
        await interaction.response.defer(thinking=True)
        ping = self.app.latency * 1000
        await interaction.followup.send(f"Pong! `{ping} ms`")

```
Để có thể tự động đưa init_variable vào thì bạn cần custom_mapping. Chúng ta sẽ nói về custom_mapping trong phần sau